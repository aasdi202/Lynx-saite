<!DOCTYPE html><html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>داشبورد LYNX</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .container {
      max-width: 500px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 { color: #333; margin-bottom: 20px; }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover { background-color: #45a049; }
    .info { text-align: right; margin-top: 20px; direction: rtl; }
    .info div { margin-bottom: 10px; }
    .form-group { margin-top: 30px; text-align: right; direction: rtl; }
    input {
      padding: 8px;
      width: 100%;
      margin-top: 6px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 15px;
    }
    .message { margin-top: 15px; font-weight: bold; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>داشبورد LYNX</h1>
    <button onclick="connectWallet()">اتصال کیف پول</button>
    <div class="info">
      <div><strong>آدرس شما:</strong> <span id="account">--</span></div>
      <div><strong>موجودی LYNX:</strong> <span id="balance">--</span></div>
      <hr>
      <div><strong>نام توکن:</strong> <span id="tokenName">--</span></div>
      <div><strong>نماد:</strong> <span id="tokenSymbol">--</span></div>
      <div><strong>تعداد کل:</strong> <span id="totalSupply">--</span></div>
    </div><div class="form-group">
  <h3>ارسال توکن LYNX</h3>
  <label>آدرس گیرنده:</label>
  <input type="text" id="recipient" placeholder="مثلاً 0xabc123...">
  <label>مقدار:</label>
  <input type="number" id="amount" placeholder="مثلاً 10">
  <button onclick="sendTokens()">ارسال</button>
  <div class="message" id="message"></div>
</div>

  </div>  <script>
    const TOKEN_ADDRESS = "0xbd61721063343EC6CCD7c077a11c1cD200AAFB40";
    const ABI = [
      "function name() view returns (string)",
      "function symbol() view returns (string)",
      "function decimals() view returns (uint8)",
      "function totalSupply() view returns (uint256)",
      "function balanceOf(address) view returns (uint)",
      "function transfer(address to, uint amount) returns (bool)"
    ];

    let signer, contract, decimals, symbol;

    async function connectWallet() {
      if (typeof window.ethereum !== 'undefined') {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        const account = await signer.getAddress();
        document.getElementById('account').textContent = account;

        contract = new ethers.Contract(TOKEN_ADDRESS, ABI, signer);
        [decimals, symbol] = await Promise.all([
          contract.decimals(),
          contract.symbol()
        ]);

        const [balance, name, totalSupply] = await Promise.all([
          contract.balanceOf(account),
          contract.name(),
          contract.totalSupply()
        ]);

        document.getElementById('balance').textContent = ethers.utils.formatUnits(balance, decimals) + ' ' + symbol;
        document.getElementById('tokenName').textContent = name;
        document.getElementById('tokenSymbol').textContent = symbol;
        document.getElementById('totalSupply').textContent = ethers.utils.formatUnits(totalSupply, decimals) + ' ' + symbol;
      } else {
        alert("لطفاً متامسک را نصب کنید.");
      }
    }

    async function sendTokens() {
      const recipient = document.getElementById('recipient').value.trim();
      const amount = document.getElementById('amount').value;
      const message = document.getElementById('message');
      message.textContent = '';
      
      if (!recipient || !amount) {
        message.textContent = 'لطفاً آدرس و مقدار را وارد کنید.';
        message.style.color = 'red';
        return;
      }

      try {
        const value = ethers.utils.parseUnits(amount, decimals);
        const tx = await contract.transfer(recipient, value);
        message.textContent = 'در حال ارسال...';
        message.style.color = 'blue';
        await tx.wait();
        message.textContent = 'ارسال با موفقیت انجام شد!';
        message.style.color = 'green';
        connectWallet(); // برای بروزرسانی موجودی
      } catch (err) {
        console.error(err);
        message.textContent = 'خطا در ارسال: ' + (err.data?.message || err.message);
        message.style.color = 'red';
      }
    }
  </script></body>
</html>
